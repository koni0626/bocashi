bocashi
====

車のナンバー、人の顔をぼかします

## 前提プログラム
python 3.6.7

## 前提ライブラリ
flask,werkzeug,zc,argparse

## サーバーの実行形式
### 書式
python3 bocashi-server.py [-p port] [-w wait_time] [-r retry_times] 

### 引数
<dl>
  <dt>-p port</dt>
  <dd>サーバを起動するときのポート番号を1～65535の整数値で指定します。省略時は5000を仮定します。</dd>
  <dt>-w wait_time</dt>
  <dd>同時に要求があった場合に、後続の処理が待機する時間を秒単位で指定します。省略時は1秒を仮定します。</dd>
  <dt>-r retry_times</dt>
  <dd>同時に要求があった場合に-wオプションに指定した時間を経過しても、まだ前の処理が処理を行っている場合に待機し直す回数を指定します。省略時は10回を仮定します。</dd>
</dl>
  
## 注意事項
* 複数のクライアントから接続された場合、前の処理が終わるまで次の処理は最大10秒間待機します。10秒を超えた場合、タイムアウトします。
* デフォルトでは1秒待機を10回繰り返すため、最大10秒間待つことがあります

# API
## ぼかしの要求
サーバ側でぼかした画像を作成します。作成した画像ファイル名を応答で返します。
### REQUEST
POST形式。

| パラメーター            |        説明              |
|:------------------------|:-------------------------|
| img_file                | 画像ファイルの内容を指定します。|
| car_op                  | 車のナンバーをぼかす場合に1を指定します。ぼかさない場合は0を指定します。省略した場合は1を仮定します |
| face_op                 | 顔をぼかす場合に1を指定します。ぼかさない場合は0を指定します。省略した場合は1を仮定します |
### RESPONSE
JSON形式で応答が返る。

| パラメーター            |        説明              |
|:------------------------|:-------------------------|
| ResultSet/status        | 0の場合、正常に画像にぼかしを入れることができたことを表す。0以外の場合、処理に失敗したことを表す。 |
| ResultSet/file_name     | statusが0の場合、ぼかし画像のファイル名が返る。statusが0以外の場合空文字が返る |
| ResultSet/error_message | エラー要因のメッセージが返る。正常時は空文字が返る。 |

## ぼかし画像取得
ぼかした画像をサーバからダウンロードします。 

### REQUEST
GET形式。ぼかし要求で得られたファイル名を「ぼかしの要求時の応答で得られたファイル名」に指定します。  
http://URL:5000/download/ファイル名

### RESPONSE
画像ファイルを返却する。  

## ぼかし画像削除
サーバ上のぼかし画像を削除します。  

### REQUEST
GET形式。ぼかし要求で得られたファイル名を「ぼかしの要求時の応答で得られたファイル名」に指定します。  
http://URL:5000/delete/ファイル名

### RESPONSE
| パラメーター            |        説明              |
|:------------------------|:-------------------------|
| ResultSet/status        | 0の場合、正常に画像にぼかしを入れることができたことを表す。0以外の場合、処理に失敗したことを表す。 |
| ResultSet/file_name     | statusが0の場合、削除した画像のファイル名が返る。statusが0以外の場合空文字が返る |
| ResultSet/error_message | エラー要因のメッセージが返る。正常時は空文字が返る。 |


## サンプルプログラム
clientフォルダのbocashi-client.pyを参照ください。
